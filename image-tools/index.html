<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Image Compressor & Resizer Tool</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&amp;display=swap" rel="stylesheet"/>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Theme Config -->
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "primary-dark": "#0b5ed7",
                        "secondary": "#8b5cf6",
                        "secondary-dark": "#7c3aed",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "success": "#10b981",
                        "warning": "#f59e0b",
                        "error": "#ef4444",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "body": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.375rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    
    <style>
        /* Custom hover effect for drop zone */
        .drop-zone:hover {
            border-color: #137fec;
            background-color: rgba(19, 127, 236, 0.05);
        }
        
        .drop-zone.drag-over {
            border-color: #137fec;
            background-color: rgba(19, 127, 236, 0.1);
        }
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: #4a5568;
        }
        
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
        
        /* Progress bar animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 28px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #137fec;
        }
        
        input:checked + .slider:before {
            transform: translateX(32px);
        }
        
        /* Range slider styling */
        input[type="range"] {
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #cbd5e1;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #137fec;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .dark input[type="range"] {
            background: #4b5563;
        }
        
        .dark input[type="range"]::-webkit-slider-thumb {
            background: #137fec;
            border: 2px solid #1f2937;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
        }
        
        .dark .modal-content {
            background: #1f2937;
        }
        
        /* Tab styles */
        .tab-button {
            padding: 10px 20px;
            border-bottom: 2px solid transparent;
            color: #64748b;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-button.active {
            color: #137fec;
            border-bottom-color: #137fec;
        }
        
        .dark .tab-button {
            color: #94a3b8;
        }
        
        .dark .tab-button.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
        }
        
        /* Aspect ratio preview */
        .aspect-preview {
            width: 80px;
            height: 80px;
            border: 2px dashed #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .aspect-preview.active {
            border-color: #137fec;
            background-color: rgba(19, 127, 236, 0.05);
        }
        
        .dark .aspect-preview {
            border-color: #4b5563;
        }
        
        .dark .aspect-preview.active {
            border-color: #60a5fa;
            background-color: rgba(96, 165, 250, 0.1);
        }
        
        /* Status badges */
        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .dark .status-pending {
            background-color: #78350f;
            color: #fef3c7;
        }
        
        .status-compressed {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .dark .status-compressed {
            background-color: #064e3b;
            color: #d1fae5;
        }
        
        .status-resized {
            background-color: #e0e7ff;
            color: #3730a3;
        }
        
        .dark .status-resized {
            background-color: #312e81;
            color: #e0e7ff;
        }
        
        /* Final action button */
        .final-action-btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }
        
        .compress-btn {
            background-color: #137fec;
            color: white;
        }
        
        .compress-btn:hover {
            background-color: #0b5ed7;
        }
        
        .resize-btn {
            background-color: #8b5cf6;
            color: white;
        }
        
        .resize-btn:hover {
            background-color: #7c3aed;
        }
        
        .download-btn {
            background-color: #10b981;
            color: white;
        }
        
        .download-btn:hover {
            background-color: #059669;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-50 transition-colors duration-200">
    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
        <!-- Navigation -->
        <header class="flex items-center justify-between border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md px-6 py-4 sticky top-0 z-50">
            <div class="flex items-center gap-4">
                <div class="size-8 text-primary flex items-center justify-center">
                    <span class="material-symbols-outlined text-3xl">compress</span>
                </div>
                <h2 class="text-slate-900 dark:text-white text-lg font-bold tracking-tight">Image Tool</h2>
            </div>
            <div class="hidden md:flex flex-1 justify-end gap-8 items-center">
                <!-- Tab Selection -->
                <div class="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 rounded-lg p-1">
                    <button id="tab-compress" class="tab-button active px-4 py-1.5 rounded-md">
                        <span class="material-symbols-outlined align-middle text-base mr-1">compress</span>
                        Compress
                    </button>
                    <button id="tab-resize" class="tab-button px-4 py-1.5 rounded-md">
                        <span class="material-symbols-outlined align-middle text-base mr-1">photo_size_select_large</span>
                        Resize
                    </button>
                </div>
                
                <!-- Home Button -->
                <a href="/" class="text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-lg">home</span>
                    <span>Home</span>
                </a>
                
                <button class="text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors" id="theme-toggle">
                    <span class="material-symbols-outlined text-lg" id="theme-icon">dark_mode</span>
                </button>
                
                <button class="flex cursor-pointer items-center justify-center rounded-lg h-9 px-5 bg-primary hover:bg-primary-dark text-white text-sm font-bold transition-colors shadow-sm" id="clear-all-btn">
                    <span class="material-symbols-outlined text-lg mr-2">delete</span>
                    <span>Clear All</span>
                </button>
            </div>
            
            <!-- Mobile Menu -->
            <div class="md:hidden flex items-center gap-4">
                <!-- Mobile Home Button -->
                <a href="/" class="text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-lg">home</span>
                </a>
                
                <!-- Mobile Theme Toggle -->
                <button class="text-slate-600 dark:text-slate-300 hover:text-primary" id="mobile-theme-toggle">
                    <span class="material-symbols-outlined text-lg" id="mobile-theme-icon">dark_mode</span>
                </button>
                
                <!-- Mobile Menu Button -->
                <button class="text-slate-600 dark:text-slate-300 hover:text-primary" id="mobile-menu-btn">
                    <span class="material-symbols-outlined text-2xl">menu</span>
                </button>
            </div>
        </header>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="md:hidden fixed inset-0 bg-black/50 z-50 hidden transition-opacity duration-300">
            <div class="absolute right-0 top-0 h-full w-64 bg-white dark:bg-slate-900 shadow-xl transform transition-transform duration-300 translate-x-full">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="text-slate-900 dark:text-white text-lg font-bold">Menu</h3>
                        <button class="text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 close-mobile-menu">
                            <span class="material-symbols-outlined text-2xl">close</span>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Tabs in Mobile Menu -->
                        <div class="space-y-2">
                            <h4 class="text-slate-500 dark:text-slate-400 text-xs font-semibold uppercase tracking-wider mb-2">Tools</h4>
                            <button id="mobile-menu-compress" class="flex items-center gap-3 w-full p-3 rounded-lg bg-slate-100 dark:bg-slate-800 text-primary font-medium">
                                <span class="material-symbols-outlined">compress</span>
                                <span>Compress Images</span>
                            </button>
                            <button id="mobile-menu-resize" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 font-medium">
                                <span class="material-symbols-outlined">photo_size_select_large</span>
                                <span>Resize Images</span>
                            </button>
                        </div>
                        
                        <div class="pt-6 border-t border-slate-200 dark:border-slate-800">
                            <button class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 font-medium">
                                <span class="material-symbols-outlined">help</span>
                                <span>Help & Support</span>
                            </button>
                            <button class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 font-medium">
                                <span class="material-symbols-outlined">privacy_tip</span>
                                <span>Privacy Policy</span>
                            </button>
                            <button class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 font-medium">
                                <span class="material-symbols-outlined">description</span>
                                <span>Terms of Service</span>
                            </button>
                        </div>
                        
                        <!-- Clear All Button in Mobile Menu -->
                        <button class="w-full mt-6 p-3 rounded-lg bg-primary hover:bg-primary-dark text-white font-bold flex items-center justify-center gap-2">
                            <span class="material-symbols-outlined">delete</span>
                            <span>Clear All Images</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Tabs -->
        <div class="md:hidden border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900">
            <div class="flex justify-center">
                <div class="flex w-full max-w-md">
                    <button id="tab-compress-mobile" class="tab-button active flex-1 text-center py-3">
                        <span class="material-symbols-outlined align-middle text-base mr-1">compress</span>
                        Compress
                    </button>
                    <button id="tab-resize-mobile" class="tab-button flex-1 text-center py-3">
                        <span class="material-symbols-outlined align-middle text-base mr-1">photo_size_select_large</span>
                        Resize
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col items-center py-8 px-4 sm:px-6 lg:px-8">
            <div class="w-full max-w-6xl flex flex-col gap-8">
                <!-- Hero Heading -->
                <div class="text-center space-y-4">
                    <h1 id="main-title" class="text-slate-900 dark:text-white text-4xl sm:text-5xl font-black tracking-tight leading-tight">
                        Smart Image Compression
                    </h1>
                    <p id="main-subtitle" class="text-slate-500 dark:text-slate-400 text-lg sm:text-xl font-normal max-w-2xl mx-auto">
                        Reduce file size by up to 80% while maintaining perfect quality. Fast, secure, and free.
                    </p>
                </div>

                <!-- Upload Area -->
                <div class="w-full max-w-2xl mx-auto">
                    <div id="drop-zone" class="drop-zone group relative flex flex-col items-center justify-center gap-6 rounded-2xl border-2 border-dashed border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800/50 p-8 sm:p-12 transition-all duration-300 shadow-sm hover:shadow-md cursor-pointer">
                        <!-- Icon Circle -->
                        <div class="flex h-20 w-20 items-center justify-center rounded-full bg-primary/10 dark:bg-primary/20 text-primary mb-2 transition-transform group-hover:scale-110 duration-300">
                            <span class="material-symbols-outlined text-4xl">cloud_upload</span>
                        </div>
                        <div class="flex flex-col items-center gap-2 text-center z-10">
                            <p class="text-slate-900 dark:text-white text-xl font-bold">Drag your images here</p>
                            <p class="text-slate-500 dark:text-slate-400 text-sm">or browse from your device</p>
                        </div>
                        <input type="file" id="file-input" class="hidden" accept=".jpg,.jpeg,.png,.webp,.gif,.bmp,.tiff" multiple>
                        <button id="select-images-btn" class="relative flex items-center justify-center rounded-lg h-11 px-8 bg-primary hover:bg-primary-dark text-white text-sm font-bold shadow-md hover:shadow-lg transition-all transform group-hover:-translate-y-0.5 mt-2">
                            Select Images
                        </button>
                        <!-- Absolute pattern for visual interest -->
                        <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoMTksIDEyNywgMjM2LCAwLjA1KSIvPjwvc3ZnPg==')] opacity-50 z-0 pointer-events-none rounded-2xl"></div>
                    </div>
                </div>

                <!-- Settings Section (Dynamic based on tab) -->
                <div id="settings-section" class="hidden w-full max-w-2xl mx-auto bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm">
                    <!-- Compression Settings -->
                    <div id="compress-settings" class="space-y-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-slate-900 dark:text-white text-xl font-bold">Compression Settings</h3>
                            <button id="batch-compress-btn" class="flex items-center gap-2 rounded-lg h-9 px-4 bg-success hover:bg-green-700 text-white text-sm font-bold transition-colors shadow-sm">
                                <span class="material-symbols-outlined text-lg">compress</span>
                                <span>Compress All</span>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <label class="text-slate-700 dark:text-slate-300 text-sm font-medium">Quality</label>
                                    <span class="text-primary font-bold text-sm"><span id="quality-value">80</span>%</span>
                                </div>
                                <input type="range" id="quality-slider" min="10" max="95" value="80" class="w-full">
                                <div class="flex justify-between text-xs text-slate-500 dark:text-slate-400 mt-1">
                                    <span>Smaller Size</span>
                                    <span>Better Quality</span>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-2 block">Output Format</label>
                                    <select id="output-format" class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                                        <option value="original">Keep Original</option>
                                        <option value="jpeg">JPEG</option>
                                        <option value="png">PNG</option>
                                        <option value="webp">WebP</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-2 block">Max Width (px)</label>
                                    <input type="number" id="max-width" min="100" max="4000" value="1920" class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resize Settings -->
                    <div id="resize-settings" class="hidden space-y-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-slate-900 dark:text-white text-xl font-bold">Resize Settings</h3>
                            <button id="batch-resize-btn" class="flex items-center gap-2 rounded-lg h-9 px-4 bg-secondary hover:bg-secondary-dark text-white text-sm font-bold transition-colors shadow-sm">
                                <span class="material-symbols-outlined text-lg">photo_size_select_large</span>
                                <span>Resize All</span>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- Resize Mode Selection -->
                            <div>
                                <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-3 block">Resize Mode</label>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                    <button id="resize-mode-custom" class="resize-mode-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors active">
                                        <span class="material-symbols-outlined text-primary text-2xl">crop_free</span>
                                        <span class="text-slate-900 dark:text-white font-medium text-sm">Custom Size</span>
                                    </button>
                                    <button id="resize-mode-preset" class="resize-mode-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
                                        <span class="material-symbols-outlined text-slate-500 dark:text-slate-400 text-2xl">photo_size_select_large</span>
                                        <span class="text-slate-900 dark:text-white font-medium text-sm">Preset Sizes</span>
                                    </button>
                                    <button id="resize-mode-percentage" class="resize-mode-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
                                        <span class="material-symbols-outlined text-slate-500 dark:text-slate-400 text-2xl">percent</span>
                                        <span class="text-slate-900 dark:text-white font-medium text-sm">Percentage</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Custom Size Settings -->
                            <div id="custom-size-settings" class="space-y-4">
                                <div class="flex items-center justify-between mb-2">
                                    <label class="text-slate-700 dark:text-slate-300 text-sm font-medium">Maintain Aspect Ratio</label>
                                    <label class="switch">
                                        <input type="checkbox" id="aspect-ratio-toggle" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-2 block">Width (px)</label>
                                        <input type="number" id="resize-width" min="10" max="5000" value="800" class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                                    </div>
                                    
                                    <div>
                                        <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-2 block">Height (px)</label>
                                        <input type="number" id="resize-height" min="10" max="5000" value="600" class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                                    </div>
                                </div>
                                
                                <!-- Common Aspect Ratios -->
                                <div>
                                    <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-2 block">Common Aspect Ratios</label>
                                    <div class="flex flex-wrap gap-3">
                                        <button class="aspect-ratio-btn aspect-preview" data-ratio="1:1" data-width="500" data-height="500">
                                            <div class="text-xs font-medium">1:1</div>
                                        </button>
                                        <button class="aspect-ratio-btn aspect-preview" data-ratio="4:3" data-width="800" data-height="600">
                                            <div class="text-xs font-medium">4:3</div>
                                        </button>
                                        <button class="aspect-ratio-btn aspect-preview" data-ratio="16:9" data-width="1280" data-height="720">
                                            <div class="text-xs font-medium">16:9</div>
                                        </button>
                                        <button class="aspect-ratio-btn aspect-preview" data-ratio="3:2" data-width="1200" data-height="800">
                                            <div class="text-xs font-medium">3:2</div>
                                        </button>
                                        <button class="aspect-ratio-btn aspect-preview" data-ratio="9:16" data-width="720" data-height="1280">
                                            <div class="text-xs font-medium">9:16</div>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Preset Sizes -->
                            <div id="preset-size-settings" class="hidden space-y-4">
                                <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-2 block">Select Preset Size</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                    <button class="preset-size-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors" data-width="1920" data-height="1080">
                                        <span class="text-slate-900 dark:text-white font-bold">Full HD</span>
                                        <span class="text-slate-500 dark:text-slate-400 text-xs">1920 × 1080</span>
                                    </button>
                                    <button class="preset-size-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors" data-width="1280" data-height="720">
                                        <span class="text-slate-900 dark:text-white font-bold">HD</span>
                                        <span class="text-slate-500 dark:text-slate-400 text-xs">1280 × 720</span>
                                    </button>
                                    <button class="preset-size-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors" data-width="1024" data-height="768">
                                        <span class="text-slate-900 dark:text-white font-bold">Tablet</span>
                                        <span class="text-slate-500 dark:text-slate-400 text-xs">1024 × 768</span>
                                    </button>
                                    <button class="preset-size-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors" data-width="800" data-height="600">
                                        <span class="text-slate-900 dark:text-white font-bold">Small</span>
                                        <span class="text-slate-500 dark:text-slate-400 text-xs">800 × 600</span>
                                    </button>
                                    <button class="preset-size-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors" data-width="640" data-height="480">
                                        <span class="text-slate-900 dark:text-white font-bold">VGA</span>
                                        <span class="text-slate-500 dark:text-slate-400 text-xs">640 × 480</span>
                                    </button>
                                    <button class="preset-size-btn flex flex-col items-center justify-center gap-2 p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors" data-width="400" data-height="300">
                                        <span class="text-slate-900 dark:text-white font-bold">Thumbnail</span>
                                        <span class="text-slate-500 dark:text-slate-400 text-xs">400 × 300</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Percentage Settings -->
                            <div id="percentage-size-settings" class="hidden space-y-4">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-slate-700 dark:text-slate-300 text-sm font-medium">Resize Percentage</label>
                                        <span class="text-primary font-bold text-sm"><span id="percentage-value">50</span>%</span>
                                    </div>
                                    <input type="range" id="percentage-slider" min="10" max="200" value="50" class="w-full">
                                    <div class="flex justify-between text-xs text-slate-500 dark:text-slate-400 mt-1">
                                        <span>10%</span>
                                        <span>Original</span>
                                        <span>200%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Uploaded Images List -->
                <div id="uploaded-list" class="hidden w-full max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-slate-900 dark:text-white text-xl font-bold">Uploaded Images</h3>
                        <div class="text-sm text-slate-600 dark:text-slate-400">
                            <span id="total-images">0</span> images selected
                        </div>
                    </div>
                    
                    <div id="images-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Images will be dynamically added here -->
                    </div>
                </div>

                <!-- Progress Section -->
                <div id="progress-section" class="hidden w-full max-w-2xl mx-auto">
                    <div class="bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <h3 id="progress-title" class="text-slate-900 dark:text-white text-xl font-bold">Processing</h3>
                            <div class="text-sm text-primary font-medium">
                                <span id="processed-count">0</span>/<span id="total-count">0</span>
                            </div>
                        </div>
                        
                        <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mb-4">
                            <div id="progress-bar" class="bg-primary h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        
                        <p id="progress-text" class="text-sm text-slate-600 dark:text-slate-400 text-center">Preparing to process images...</p>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="results-section" class="hidden w-full max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 id="results-title" class="text-slate-900 dark:text-white text-xl font-bold">Results</h3>
                        <button id="download-all-btn" class="flex items-center gap-2 rounded-lg h-9 px-4 bg-primary hover:bg-primary-dark text-white text-sm font-bold transition-colors shadow-sm">
                            <span class="material-symbols-outlined text-lg">download</span>
                            <span>Download All</span>
                        </button>
                    </div>
                    
                    <div id="results-container" class="space-y-4">
                        <!-- Results will be dynamically added here -->
                    </div>
                </div>

                <!-- Supported Formats Chips -->
                <div class="flex justify-center flex-wrap gap-3">
                    <div class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold uppercase tracking-wide">
                        <span class="material-symbols-outlined text-[16px]">image</span>
                        JPG
                    </div>
                    <div class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold uppercase tracking-wide">
                        <span class="material-symbols-outlined text-[16px]">image</span>
                        PNG
                    </div>
                    <div class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold uppercase tracking-wide">
                        <span class="material-symbols-outlined text-[16px]">image</span>
                        WEBP
                    </div>
                    <div class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold uppercase tracking-wide">
                        <span class="material-symbols-outlined text-[16px]">image</span>
                        GIF
                    </div>
                    <div class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-orange-50 dark:bg-orange-900/20 border border-orange-100 dark:border-orange-800/30 text-orange-700 dark:text-orange-400 text-xs font-semibold uppercase tracking-wide">
                        <span class="material-symbols-outlined text-[16px]">warning</span>
                        Max 10MB
                    </div>
                </div>

                <!-- Feature Section -->
                <div class="mt-12 w-full">
                    <div class="flex flex-col gap-6">
                        <div class="flex items-center gap-4">
                            <h3 class="text-slate-900 dark:text-white text-2xl font-bold tracking-tight">Why use our tool?</h3>
                            <div class="h-px flex-1 bg-slate-200 dark:bg-slate-800"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Feature 1 -->
                            <div class="flex flex-col gap-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 p-6 shadow-sm hover:shadow-md transition-shadow">
                                <div class="size-12 rounded-lg bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-primary">
                                    <span class="material-symbols-outlined">bolt</span>
                                </div>
                                <div class="space-y-2">
                                    <h4 class="text-slate-900 dark:text-white text-lg font-bold">Lightning Fast</h4>
                                    <p class="text-slate-500 dark:text-slate-400 text-sm leading-relaxed">
                                        Advanced algorithms process your images instantly within your browser. No queue times.
                                    </p>
                                </div>
                            </div>
                            <!-- Feature 2 -->
                            <div class="flex flex-col gap-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 p-6 shadow-sm hover:shadow-md transition-shadow">
                                <div class="size-12 rounded-lg bg-green-50 dark:bg-green-900/20 flex items-center justify-center text-green-600 dark:text-green-400">
                                    <span class="material-symbols-outlined">verified_user</span>
                                </div>
                                <div class="space-y-2">
                                    <h4 class="text-slate-900 dark:text-white text-lg font-bold">Privacy First</h4>
                                    <p class="text-slate-500 dark:text-slate-400 text-sm leading-relaxed">
                                        All processing happens locally in your browser. Your images never leave your device.
                                    </p>
                                </div>
                            </div>
                            <!-- Feature 3 -->
                            <div class="flex flex-col gap-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 p-6 shadow-sm hover:shadow-md transition-shadow">
                                <div class="size-12 rounded-lg bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-secondary">
                                    <span class="material-symbols-outlined">photo_size_select_large</span>
                                </div>
                                <div class="space-y-2">
                                    <h4 class="text-slate-900 dark:text-white text-lg font-bold">Compress & Resize</h4>
                                    <p class="text-slate-500 dark:text-slate-400 text-sm leading-relaxed">
                                        Two tools in one! Compress to reduce file size or resize to change dimensions - all in one place.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Simple Footer -->
        <footer class="border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 py-8">
            <div class="max-w-4xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-slate-500 dark:text-slate-400">
                <p>© 2023 Image Tool. All rights reserved.</p>
                <div class="flex gap-6">
                    <a class="hover:text-primary transition-colors" href="#">Privacy Policy</a>
                    <a class="hover:text-primary transition-colors" href="#">Terms of Service</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript for Image Processing -->
    <script>
        // DOM Elements
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const selectImagesBtn = document.getElementById('select-images-btn');
        const settingsSection = document.getElementById('settings-section');
        const uploadedList = document.getElementById('uploaded-list');
        const imagesContainer = document.getElementById('images-container');
        const totalImagesSpan = document.getElementById('total-images');
        const progressSection = document.getElementById('progress-section');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const progressTitle = document.getElementById('progress-title');
        const processedCount = document.getElementById('processed-count');
        const totalCount = document.getElementById('total-count');
        const resultsSection = document.getElementById('results-section');
        const resultsContainer = document.getElementById('results-container');
        const resultsTitle = document.getElementById('results-title');
        const downloadAllBtn = document.getElementById('download-all-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const clearAllBtn = document.getElementById('clear-all-btn');
        const mainTitle = document.getElementById('main-title');
        const mainSubtitle = document.getElementById('main-subtitle');

        // Mobile Menu Elements
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
        const closeMobileMenuBtn = document.querySelector('.close-mobile-menu');
        const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
        const mobileThemeIcon = document.getElementById('mobile-theme-icon');
        const mobileMenuCompress = document.getElementById('mobile-menu-compress');
        const mobileMenuResize = document.getElementById('mobile-menu-resize');

        // Tab Elements
        const tabCompress = document.getElementById('tab-compress');
        const tabResize = document.getElementById('tab-resize');
        const tabCompressMobile = document.getElementById('tab-compress-mobile');
        const tabResizeMobile = document.getElementById('tab-resize-mobile');
        const compressSettings = document.getElementById('compress-settings');
        const resizeSettings = document.getElementById('resize-settings');

        // Compression Settings
        const qualitySlider = document.getElementById('quality-slider');
        const qualityValue = document.getElementById('quality-value');
        const outputFormatSelect = document.getElementById('output-format');
        const maxWidthInput = document.getElementById('max-width');
        const batchCompressBtn = document.getElementById('batch-compress-btn');

        // Resize Settings
        const batchResizeBtn = document.getElementById('batch-resize-btn');
        const resizeModeButtons = document.querySelectorAll('.resize-mode-btn');
        const customSizeSettings = document.getElementById('custom-size-settings');
        const presetSizeSettings = document.getElementById('preset-size-settings');
        const percentageSizeSettings = document.getElementById('percentage-size-settings');
        const aspectRatioToggle = document.getElementById('aspect-ratio-toggle');
        const resizeWidthInput = document.getElementById('resize-width');
        const resizeHeightInput = document.getElementById('resize-height');
        const aspectRatioButtons = document.querySelectorAll('.aspect-ratio-btn');
        const presetSizeButtons = document.querySelectorAll('.preset-size-btn');
        const percentageSlider = document.getElementById('percentage-slider');
        const percentageValue = document.getElementById('percentage-value');

        // State variables
        let uploadedImages = [];
        let processedResults = [];
        let isProcessing = false;
        let currentMode = 'compress'; // 'compress' or 'resize'
        let resizeMode = 'custom'; // 'custom', 'preset', or 'percentage'

        // Event Listeners
        selectImagesBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('dragleave', handleDragLeave);
        dropZone.addEventListener('drop', handleDrop);
        batchCompressBtn.addEventListener('click', startBatchCompression);
        batchResizeBtn.addEventListener('click', startBatchResize);
        downloadAllBtn.addEventListener('click', downloadAllProcessed);
        themeToggle.addEventListener('click', toggleTheme);
        mobileThemeToggle.addEventListener('click', toggleTheme);
        clearAllBtn.addEventListener('click', clearAllImages);
        qualitySlider.addEventListener('input', updateQualityValue);
        percentageSlider.addEventListener('input', updatePercentageValue);
        aspectRatioToggle.addEventListener('change', toggleAspectRatioLock);
        resizeWidthInput.addEventListener('input', handleWidthChange);
        resizeHeightInput.addEventListener('input', handleHeightChange);

        // Mobile Menu Event Listeners
        mobileMenuBtn.addEventListener('click', openMobileMenu);
        closeMobileMenuBtn.addEventListener('click', closeMobileMenu);
        mobileMenuOverlay.addEventListener('click', (e) => {
            if (e.target === mobileMenuOverlay) {
                closeMobileMenu();
            }
        });

        // Mobile menu tab switching
        mobileMenuCompress.addEventListener('click', () => {
            switchTab('compress');
            closeMobileMenu();
        });

        mobileMenuResize.addEventListener('click', () => {
            switchTab('resize');
            closeMobileMenu();
        });

        // Tab Switching
        tabCompress.addEventListener('click', () => switchTab('compress'));
        tabResize.addEventListener('click', () => switchTab('resize'));
        tabCompressMobile.addEventListener('click', () => switchTab('compress'));
        tabResizeMobile.addEventListener('click', () => switchTab('resize'));

        // Resize Mode Switching
        resizeModeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const mode = this.id.replace('resize-mode-', '');
                switchResizeMode(mode);
            });
        });

        // Aspect Ratio Buttons
        aspectRatioButtons.forEach(button => {
            button.addEventListener('click', function() {
                const width = parseInt(this.getAttribute('data-width'));
                const height = parseInt(this.getAttribute('data-height'));
                const ratio = this.getAttribute('data-ratio');
                
                // Update inputs
                resizeWidthInput.value = width;
                resizeHeightInput.value = height;
                
                // Update active state
                aspectRatioButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Lock aspect ratio
                aspectRatioToggle.checked = true;
            });
        });

        // Preset Size Buttons
        presetSizeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const width = parseInt(this.getAttribute('data-width'));
                const height = parseInt(this.getAttribute('data-height'));
                
                // Update inputs
                resizeWidthInput.value = width;
                resizeHeightInput.value = height;
                
                // Update active state
                presetSizeButtons.forEach(btn => btn.classList.remove('active', 'bg-primary/10', 'dark:bg-primary/20'));
                this.classList.add('active', 'bg-primary/10', 'dark:bg-primary/20');
                this.classList.add('border-primary', 'dark:border-primary');
            });
        });

        // Mobile Menu Functions
        function openMobileMenu() {
            mobileMenuOverlay.classList.remove('hidden');
            setTimeout(() => {
                mobileMenuOverlay.querySelector('div').classList.remove('translate-x-full');
            }, 10);
        }

        function closeMobileMenu() {
            mobileMenuOverlay.querySelector('div').classList.add('translate-x-full');
            setTimeout(() => {
                mobileMenuOverlay.classList.add('hidden');
            }, 300);
        }

        // Initialize
        function init() {
            initTheme();
            updateQualityValue();
            updatePercentageValue();
            switchTab('compress');
            switchResizeMode('custom');
        }

        // Theme Functions
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
                themeIcon.textContent = 'light_mode';
                mobileThemeIcon.textContent = 'light_mode';
            } else {
                document.documentElement.classList.remove('dark');
                themeIcon.textContent = 'dark_mode';
                mobileThemeIcon.textContent = 'dark_mode';
            }
        }

        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                themeIcon.textContent = 'dark_mode';
                mobileThemeIcon.textContent = 'dark_mode';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                themeIcon.textContent = 'light_mode';
                mobileThemeIcon.textContent = 'light_mode';
            }
        }

        // Tab Switching Functions
        function switchTab(tab) {
            currentMode = tab;
            
            // Update tab buttons
            const tabs = [tabCompress, tabResize, tabCompressMobile, tabResizeMobile];
            tabs.forEach(t => t.classList.remove('active'));
            
            // Update mobile menu buttons
            mobileMenuCompress.classList.remove('bg-slate-100', 'dark:bg-slate-800', 'text-primary');
            mobileMenuResize.classList.remove('bg-slate-100', 'dark:bg-slate-800', 'text-primary');
            mobileMenuCompress.classList.add('hover:bg-slate-100', 'dark:hover:bg-slate-800', 'text-slate-600', 'dark:text-slate-400');
            mobileMenuResize.classList.add('hover:bg-slate-100', 'dark:hover:bg-slate-800', 'text-slate-600', 'dark:text-slate-400');
            
            if (tab === 'compress') {
                tabCompress.classList.add('active');
                tabCompressMobile.classList.add('active');
                compressSettings.classList.remove('hidden');
                resizeSettings.classList.add('hidden');
                mainTitle.textContent = 'Smart Image Compression';
                mainSubtitle.textContent = 'Reduce file size by up to 80% while maintaining perfect quality. Fast, secure, and free.';
                batchCompressBtn.classList.remove('hidden');
                batchResizeBtn.classList.add('hidden');
                
                // Update mobile menu active state
                mobileMenuCompress.classList.remove('hover:bg-slate-100', 'dark:hover:bg-slate-800', 'text-slate-600', 'dark:text-slate-400');
                mobileMenuCompress.classList.add('bg-slate-100', 'dark:bg-slate-800', 'text-primary');
            } else {
                tabResize.classList.add('active');
                tabResizeMobile.classList.add('active');
                compressSettings.classList.add('hidden');
                resizeSettings.classList.remove('hidden');
                mainTitle.textContent = 'Image Resizer Tool';
                mainSubtitle.textContent = 'Resize images to any dimension with perfect quality. Batch resize, aspect ratio control, and more.';
                batchCompressBtn.classList.add('hidden');
                batchResizeBtn.classList.remove('hidden');
                
                // Update mobile menu active state
                mobileMenuResize.classList.remove('hover:bg-slate-100', 'dark:hover:bg-slate-800', 'text-slate-600', 'dark:text-slate-400');
                mobileMenuResize.classList.add('bg-slate-100', 'dark:bg-slate-800', 'text-primary');
            }
            
            // Update results title
            updateResultsTitle();
            
            // Refresh uploaded images list to update buttons
            updateUploadedList();
        }

        function switchResizeMode(mode) {
            resizeMode = mode;
            
            // Update mode buttons
            resizeModeButtons.forEach(btn => {
                btn.classList.remove('active');
                const icon = btn.querySelector('.material-symbols-outlined');
                icon.classList.remove('text-primary');
                icon.classList.add('text-slate-500', 'dark:text-slate-400');
            });
            
            const activeBtn = document.getElementById(`resize-mode-${mode}`);
            activeBtn.classList.add('active');
            const activeIcon = activeBtn.querySelector('.material-symbols-outlined');
            activeIcon.classList.remove('text-slate-500', 'dark:text-slate-400');
            activeIcon.classList.add('text-primary');
            
            // Show/hide settings
            customSizeSettings.classList.add('hidden');
            presetSizeSettings.classList.add('hidden');
            percentageSizeSettings.classList.add('hidden');
            
            if (mode === 'custom') {
                customSizeSettings.classList.remove('hidden');
            } else if (mode === 'preset') {
                presetSizeSettings.classList.remove('hidden');
            } else {
                percentageSizeSettings.classList.remove('hidden');
            }
        }

        // Update display values
        function updateQualityValue() {
            qualityValue.textContent = qualitySlider.value;
        }

        function updatePercentageValue() {
            percentageValue.textContent = percentageSlider.value;
        }

        // Aspect Ratio Handling
        let originalAspectRatio = null;
        let isAspectRatioLocked = true;

        function toggleAspectRatioLock() {
            isAspectRatioLocked = aspectRatioToggle.checked;
        }

        function handleWidthChange() {
            if (isAspectRatioLocked && originalAspectRatio && resizeWidthInput.value) {
                const newHeight = Math.round(resizeWidthInput.value / originalAspectRatio);
                resizeHeightInput.value = newHeight;
            }
        }

        function handleHeightChange() {
            if (isAspectRatioLocked && originalAspectRatio && resizeHeightInput.value) {
                const newWidth = Math.round(resizeHeightInput.value * originalAspectRatio);
                resizeWidthInput.value = newWidth;
            }
        }

        // File Handling
        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            // Filter only image files
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                alert('Please select valid image files');
                return;
            }

            // Check file sizes (max 10MB)
            const oversizedFiles = imageFiles.filter(file => file.size > 10 * 1024 * 1024);
            if (oversizedFiles.length > 0) {
                alert(`${oversizedFiles.length} file(s) exceed 10MB limit and will be skipped.`);
            }

            const validFiles = imageFiles.filter(file => file.size <= 10 * 1024 * 1024);
            
            // Limit to 20 files
            if (validFiles.length > 20) {
                alert(`You can only upload up to 20 images at once. Only the first 20 will be processed.`);
                validFiles.splice(20);
            }

            // Add files to uploaded images
            validFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = {
                        id: generateId(),
                        file: file,
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        url: e.target.result,
                        originalWidth: 0,
                        originalHeight: 0,
                        status: 'pending', // 'pending', 'compressed', 'resized'
                        processed: null,
                        resultUrl: null,
                        resultSize: 0,
                        compressionRatio: 0
                    };
                    
                    // Get image dimensions
                    const img = new Image();
                    img.onload = function() {
                        imageData.originalWidth = this.width;
                        imageData.originalHeight = this.height;
                        
                        // Set initial aspect ratio if not set
                        if (!originalAspectRatio) {
                            originalAspectRatio = this.width / this.height;
                        }
                    };
                    img.src = e.target.result;
                    
                    uploadedImages.push(imageData);
                    updateUploadedList();
                };
                reader.readAsDataURL(file);
            });

            // Reset file input
            fileInput.value = '';
        }

        // Update uploaded images list
        function updateUploadedList() {
            totalImagesSpan.textContent = uploadedImages.length;
            
            if (uploadedImages.length > 0) {
                settingsSection.classList.remove('hidden');
                uploadedList.classList.remove('hidden');
                
                // Clear container
                imagesContainer.innerHTML = '';
                
                // Add each image to the list
                uploadedImages.forEach((image) => {
                    const imageCard = document.createElement('div');
                    imageCard.className = 'flex flex-col gap-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-4';
                    
                    // Determine status badge
                    let statusBadge = '';
                    if (image.status === 'compressed') {
                        statusBadge = '<span class="status-badge status-compressed">Compressed</span>';
                    } else if (image.status === 'resized') {
                        statusBadge = '<span class="status-badge status-resized">Resized</span>';
                    } else {
                        statusBadge = '<span class="status-badge status-pending">Pending</span>';
                    }
                    
                    // Determine action button
                    let actionButton = '';
                    if (image.status === 'pending') {
                        if (currentMode === 'compress') {
                            actionButton = `
                                <button class="final-action-btn compress-btn final-compress-btn" data-id="${image.id}">
                                    <span class="material-symbols-outlined text-sm">compress</span>
                                    Compress Now
                                </button>
                            `;
                        } else {
                            actionButton = `
                                <button class="final-action-btn resize-btn final-resize-btn" data-id="${image.id}">
                                    <span class="material-symbols-outlined text-sm">photo_size_select_large</span>
                                    Resize Now
                                </button>
                            `;
                        }
                    } else {
                        actionButton = `
                            <button class="final-action-btn download-btn final-download-btn" data-id="${image.id}">
                                <span class="material-symbols-outlined text-sm">download</span>
                                Download
                            </button>
                        `;
                    }
                    
                    imageCard.innerHTML = `
                        <div class="flex items-center gap-3">
                            <div class="size-12 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-700 flex items-center justify-center">
                                <img src="${image.url}" alt="Preview" class="size-full object-cover">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between">
                                    <p class="text-slate-900 dark:text-white font-medium text-sm truncate">${image.name}</p>
                                    ${statusBadge}
                                </div>
                                <p class="text-slate-500 dark:text-slate-400 text-xs mt-1">${formatFileSize(image.size)} • ${image.originalWidth}×${image.originalHeight}</p>
                                ${image.status !== 'pending' ? `
                                    <p class="text-success text-xs font-medium mt-1">
                                        ${currentMode === 'compress' ? 'Saved: ' + (image.compressionRatio * 100).toFixed(1) + '%' : 'Resized: ' + image.resultSize + ' (' + formatFileSize(image.resultSize) + ')'}
                                    </p>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="flex gap-2">
                            <button class="preview-btn flex-1 flex items-center justify-center gap-1.5 text-slate-600 dark:text-slate-400 hover:text-primary text-sm font-medium py-2 rounded-lg border border-slate-300 dark:border-slate-600 hover:border-primary transition-colors" data-id="${image.id}">
                                <span class="material-symbols-outlined text-base">visibility</span>
                                <span>Preview</span>
                            </button>
                            
                            <button class="remove-image-btn flex items-center justify-center text-slate-400 hover:text-red-500 transition-colors p-2 rounded-lg border border-slate-300 dark:border-slate-600 hover:border-red-300" data-id="${image.id}">
                                <span class="material-symbols-outlined text-lg">delete</span>
                            </button>
                        </div>
                        
                        <div class="mt-2">
                            ${actionButton}
                        </div>
                    `;
                    
                    imagesContainer.appendChild(imageCard);
                });
                
                // Add event listeners for buttons
                document.querySelectorAll('.remove-image-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        removeImage(id);
                    });
                });
                
                document.querySelectorAll('.preview-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        previewImage(id);
                    });
                });
                
                // Final action buttons
                document.querySelectorAll('.final-compress-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        processSingleImage(id);
                    });
                });
                
                document.querySelectorAll('.final-resize-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        processSingleImage(id);
                    });
                });
                
                document.querySelectorAll('.final-download-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        downloadProcessedImageById(id);
                    });
                });
            } else {
                settingsSection.classList.add('hidden');
                uploadedList.classList.add('hidden');
                resultsSection.classList.add('hidden');
            }
        }

        // Remove image from list
        function removeImage(id) {
            uploadedImages = uploadedImages.filter(img => img.id !== id);
            updateUploadedList();
        }

        // Clear all images
        function clearAllImages() {
            if (uploadedImages.length > 0) {
                if (confirm('Are you sure you want to remove all images?')) {
                    uploadedImages = [];
                    processedResults = [];
                    updateUploadedList();
                    resultsSection.classList.add('hidden');
                }
            }
        }

        // Preview image in modal
        function previewImage(id) {
            const image = uploadedImages.find(img => img.id === id);
            if (!image) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700">
                        <h3 class="text-slate-900 dark:text-white font-bold">${image.name}</h3>
                        <button class="text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 close-modal">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <div class="p-4 overflow-auto max-h-[70vh]">
                        <img src="${image.status !== 'pending' && image.resultUrl ? image.resultUrl : image.url}" alt="${image.name}" class="max-w-full h-auto mx-auto rounded-lg">
                        <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                            <div class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg">
                                <p class="text-slate-500 dark:text-slate-400">File Size</p>
                                <p class="text-slate-900 dark:text-white font-medium">${formatFileSize(image.size)}</p>
                            </div>
                            <div class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg">
                                <p class="text-slate-500 dark:text-slate-400">Dimensions</p>
                                <p class="text-slate-900 dark:text-white font-medium">${image.originalWidth} × ${image.originalHeight}px</p>
                            </div>
                            <div class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg">
                                <p class="text-slate-500 dark:text-slate-400">Format</p>
                                <p class="text-slate-900 dark:text-white font-medium">${image.type.split('/')[1].toUpperCase()}</p>
                            </div>
                            <div class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg">
                                <p class="text-slate-500 dark:text-slate-400">Status</p>
                                <p class="text-slate-900 dark:text-white font-medium">${image.status === 'pending' ? 'Not Processed' : image.status === 'compressed' ? 'Compressed' : 'Resized'}</p>
                            </div>
                        </div>
                        ${image.status !== 'pending' ? `
                            <div class="mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <h4 class="text-green-800 dark:text-green-300 font-bold mb-2">Processing Result</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <p class="text-green-700 dark:text-green-400 text-xs">${currentMode === 'compress' ? 'Compression' : 'Resize'} Ratio</p>
                                        <p class="text-green-900 dark:text-green-300 font-bold">${currentMode === 'compress' ? (image.compressionRatio * 100).toFixed(1) + '%' : 'Completed'}</p>
                                    </div>
                                    <div>
                                        <p class="text-green-700 dark:text-green-400 text-xs">New Size</p>
                                        <p class="text-green-900 dark:text-green-300 font-bold">${formatFileSize(image.resultSize)}</p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-4 border-t border-slate-200 dark:border-slate-700 flex justify-end gap-3">
                        ${image.status === 'pending' ? `
                            <button class="process-from-modal-btn px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium" data-id="${image.id}">
                                ${currentMode === 'compress' ? 'Compress Now' : 'Resize Now'}
                            </button>
                        ` : `
                            <button class="download-from-modal-btn px-4 py-2 bg-success hover:bg-green-700 text-white rounded-lg font-medium" data-id="${image.id}">
                                Download
                            </button>
                        `}
                        <button class="px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-lg font-medium close-modal">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal
            modal.querySelector('.close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // Process from modal
            const processBtn = modal.querySelector('.process-from-modal-btn');
            if (processBtn) {
                processBtn.addEventListener('click', () => {
                    const id = processBtn.getAttribute('data-id');
                    document.body.removeChild(modal);
                    processSingleImage(id);
                });
            }
            
            // Download from modal
            const downloadBtn = modal.querySelector('.download-from-modal-btn');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', () => {
                    const id = downloadBtn.getAttribute('data-id');
                    document.body.removeChild(modal);
                    downloadProcessedImageById(id);
                });
            }
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // Process a single image (Compress or Resize)
        function processSingleImage(id) {
            const image = uploadedImages.find(img => img.id === id);
            if (!image || isProcessing) return;
            
            if (currentMode === 'compress') {
                const quality = parseInt(qualitySlider.value) / 100;
                const maxWidth = parseInt(maxWidthInput.value);
                const outputFormat = outputFormatSelect.value;
                
                compressImage(image, quality, maxWidth, outputFormat)
                    .then(result => {
                        // Update the image
                        const index = uploadedImages.findIndex(img => img.id === id);
                        if (index !== -1) {
                            uploadedImages[index].status = 'compressed';
                            uploadedImages[index].processed = result.processedBlob;
                            uploadedImages[index].resultUrl = result.resultUrl;
                            uploadedImages[index].resultSize = result.processedSize;
                            uploadedImages[index].compressionRatio = result.compressionRatio;
                            
                            // Add to processed results
                            processedResults.push(result);
                            
                            // Update UI
                            updateUploadedList();
                            showResult(result);
                            
                            // Show success message
                            showToast('success', `"${image.name}" compressed successfully!`);
                        }
                    })
                    .catch(error => {
                        console.error('Processing error:', error);
                        showToast('error', `Failed to compress "${image.name}"`);
                    });
            } else {
                // Resize mode
                let targetWidth, targetHeight;
                
                if (resizeMode === 'custom') {
                    targetWidth = parseInt(resizeWidthInput.value);
                    targetHeight = parseInt(resizeHeightInput.value);
                } else if (resizeMode === 'preset') {
                    targetWidth = parseInt(resizeWidthInput.value);
                    targetHeight = parseInt(resizeHeightInput.value);
                } else {
                    // Percentage mode
                    const percentage = parseInt(percentageSlider.value) / 100;
                    targetWidth = Math.round(image.originalWidth * percentage);
                    targetHeight = Math.round(image.originalHeight * percentage);
                }
                
                resizeImage(image, targetWidth, targetHeight)
                    .then(result => {
                        // Update the image
                        const index = uploadedImages.findIndex(img => img.id === id);
                        if (index !== -1) {
                            uploadedImages[index].status = 'resized';
                            uploadedImages[index].processed = result.processedBlob;
                            uploadedImages[index].resultUrl = result.resultUrl;
                            uploadedImages[index].resultSize = result.processedSize;
                            uploadedImages[index].compressionRatio = result.sizeChangePercent / 100;
                            
                            // Add to processed results
                            processedResults.push(result);
                            
                            // Update UI
                            updateUploadedList();
                            showResult(result);
                            
                            // Show success message
                            showToast('success', `"${image.name}" resized successfully!`);
                        }
                    })
                    .catch(error => {
                        console.error('Processing error:', error);
                        showToast('error', `Failed to resize "${image.name}"`);
                    });
            }
        }

        // Start batch compression
        function startBatchCompression() {
            if (uploadedImages.length === 0 || isProcessing) return;
            
            isProcessing = true;
            processedResults = [];
            resultsContainer.innerHTML = '';
            resultsSection.classList.add('hidden');
            
            // Show progress section
            progressSection.classList.remove('hidden');
            progressTitle.textContent = 'Compressing Images';
            totalCount.textContent = uploadedImages.length;
            processedCount.textContent = '0';
            progressBar.style.width = '0%';
            progressText.textContent = 'Starting compression...';
            
            const quality = parseInt(qualitySlider.value) / 100;
            const maxWidth = parseInt(maxWidthInput.value);
            const outputFormat = outputFormatSelect.value;
            
            processBatch(uploadedImages, 'compress', { quality, maxWidth, outputFormat });
        }

        // Start batch resize
        function startBatchResize() {
            if (uploadedImages.length === 0 || isProcessing) return;
            
            isProcessing = true;
            processedResults = [];
            resultsContainer.innerHTML = '';
            resultsSection.classList.add('hidden');
            
            // Show progress section
            progressSection.classList.remove('hidden');
            progressTitle.textContent = 'Resizing Images';
            totalCount.textContent = uploadedImages.length;
            processedCount.textContent = '0';
            progressBar.style.width = '0%';
            progressText.textContent = 'Starting resizing...';
            
            let resizeParams = {};
            
            if (resizeMode === 'custom' || resizeMode === 'preset') {
                resizeParams = {
                    width: parseInt(resizeWidthInput.value),
                    height: parseInt(resizeHeightInput.value)
                };
            } else {
                resizeParams = {
                    percentage: parseInt(percentageSlider.value) / 100
                };
            }
            
            processBatch(uploadedImages, 'resize', resizeParams);
        }

        // Process batch of images
        function processBatch(images, mode, params) {
            let processed = 0;
            
            // Process each image
            images.forEach((image, index) => {
                setTimeout(() => {
                    const processPromise = mode === 'compress' 
                        ? compressImage(image, params.quality, params.maxWidth, params.outputFormat)
                        : resizeImage(image, params.width, params.height, params.percentage);
                    
                    processPromise
                        .then(result => {
                            // Update the image
                            const imgIndex = uploadedImages.findIndex(img => img.id === image.id);
                            if (imgIndex !== -1) {
                                uploadedImages[imgIndex].status = mode === 'compress' ? 'compressed' : 'resized';
                                uploadedImages[imgIndex].processed = result.processedBlob;
                                uploadedImages[imgIndex].resultUrl = result.resultUrl;
                                uploadedImages[imgIndex].resultSize = result.processedSize;
                                uploadedImages[imgIndex].compressionRatio = mode === 'compress' ? result.compressionRatio : result.sizeChangePercent / 100;
                            }
                            
                            // Add to results
                            processedResults.push(result);
                            processed++;
                            
                            // Update progress
                            const progress = (processed / images.length) * 100;
                            progressBar.style.width = `${progress}%`;
                            processedCount.textContent = processed;
                            progressText.textContent = `${mode === 'compress' ? 'Compressing' : 'Resizing'} ${image.name}...`;
                            
                            // If all images processed
                            if (processed === images.length) {
                                isProcessing = false;
                                progressText.textContent = 'Processing complete!';
                                
                                // Update UI
                                updateUploadedList();
                                
                                // Hide progress after delay
                                setTimeout(() => {
                                    progressSection.classList.add('hidden');
                                    showAllResults();
                                    showToast('success', `Successfully processed ${images.length} image(s)!`);
                                }, 1000);
                            }
                        })
                        .catch(error => {
                            console.error('Processing error:', error);
                            processed++;
                            
                            if (processed === images.length) {
                                isProcessing = false;
                                progressSection.classList.add('hidden');
                                showAllResults();
                            }
                        });
                }, index * 100); // Stagger the processing
            });
        }

        // Compress image function
        function compressImage(image, quality, maxWidth, outputFormat) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    // Calculate new dimensions
                    let width = this.width;
                    let height = this.height;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    
                    // Fill with white background for transparent images
                    if (outputFormat === 'jpeg' || outputFormat === 'jpg') {
                        ctx.fillStyle = 'white';
                        ctx.fillRect(0, 0, width, height);
                    }
                    
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Determine output format
                    let mimeType = image.type;
                    if (outputFormat !== 'original') {
                        mimeType = outputFormat === 'jpg' ? 'image/jpeg' : `image/${outputFormat}`;
                    }
                    
                    // Compress to blob
                    canvas.toBlob(
                        blob => {
                            if (!blob) {
                                reject(new Error('Canvas to Blob conversion failed'));
                                return;
                            }
                            
                            const compressionRatio = 1 - (blob.size / image.size);
                            const result = {
                                id: image.id,
                                name: image.name,
                                originalSize: image.size,
                                processedSize: blob.size,
                                compressionRatio: compressionRatio,
                                processedBlob: blob,
                                resultUrl: URL.createObjectURL(blob),
                                format: mimeType,
                                width: width,
                                height: height,
                                mode: 'compress'
                            };
                            
                            resolve(result);
                        },
                        mimeType,
                        quality
                    );
                };
                
                img.onerror = reject;
                img.src = image.url;
            });
        }

        // Resize image function
        function resizeImage(image, targetWidth, targetHeight, percentage = null) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    // Calculate dimensions based on mode
                    let width, height;
                    
                    if (percentage) {
                        width = Math.round(this.width * percentage);
                        height = Math.round(this.height * percentage);
                    } else {
                        width = targetWidth;
                        height = targetHeight;
                    }
                    
                    // Ensure minimum dimensions
                    width = Math.max(10, width);
                    height = Math.max(10, height);
                    
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    
                    // Use high-quality image scaling
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to blob
                    canvas.toBlob(
                        blob => {
                            if (!blob) {
                                reject(new Error('Canvas to Blob conversion failed'));
                                return;
                            }
                            
                            const sizeChange = blob.size - image.size;
                            const sizeChangePercent = ((blob.size / image.size - 1) * 100).toFixed(1);
                            
                            const result = {
                                id: image.id,
                                name: image.name,
                                originalSize: image.size,
                                processedSize: blob.size,
                                sizeChange: sizeChange,
                                sizeChangePercent: sizeChangePercent,
                                processedBlob: blob,
                                resultUrl: URL.createObjectURL(blob),
                                format: image.type,
                                originalWidth: image.originalWidth,
                                originalHeight: image.originalHeight,
                                width: width,
                                height: height,
                                mode: 'resize'
                            };
                            
                            resolve(result);
                        },
                        image.type,
                        0.95 // High quality for resizing
                    );
                };
                
                img.onerror = reject;
                img.src = image.url;
            });
        }

        // Show single result
        function showResult(result) {
            if (!resultsSection.classList.contains('hidden')) {
                addResultToContainer(result);
            }
        }

        // Show all results
        function showAllResults() {
            resultsSection.classList.remove('hidden');
            resultsContainer.innerHTML = '';
            updateResultsTitle();
            
            processedResults.forEach(result => {
                addResultToContainer(result);
            });
        }

        // Update results title based on mode
        function updateResultsTitle() {
            if (currentMode === 'compress') {
                resultsTitle.textContent = 'Compression Results';
            } else {
                resultsTitle.textContent = 'Resizing Results';
            }
        }

        // Add result to results container
        function addResultToContainer(result) {
            const resultElement = document.createElement('div');
            resultElement.className = 'flex flex-col sm:flex-row gap-4 items-center justify-between rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-4';
            
            if (result.mode === 'compress') {
                const savingsPercent = (result.compressionRatio * 100).toFixed(1);
                const savingsClass = result.compressionRatio > 0.3 ? 'text-success' : 
                                   result.compressionRatio > 0.1 ? 'text-warning' : 'text-slate-600 dark:text-slate-400';
                
                resultElement.innerHTML = `
                    <div class="flex items-center gap-4 flex-1 min-w-0">
                        <div class="size-14 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-700 flex items-center justify-center">
                            <img src="${result.resultUrl}" alt="Compressed" class="size-full object-cover">
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-slate-900 dark:text-white font-medium text-sm truncate">${result.name}</p>
                            <div class="flex flex-wrap gap-3 mt-1">
                                <span class="text-xs text-slate-500 dark:text-slate-400">${result.width}×${result.height}px</span>
                                <span class="text-xs text-slate-500 dark:text-slate-400">${result.format.split('/')[1].toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <div class="text-center">
                            <p class="text-xs text-slate-500 dark:text-slate-400">Original</p>
                            <p class="text-slate-900 dark:text-white font-medium text-sm">${formatFileSize(result.originalSize)}</p>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-xs text-slate-500 dark:text-slate-400">Compressed</p>
                            <p class="text-slate-900 dark:text-white font-medium text-sm">${formatFileSize(result.processedSize)}</p>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-xs text-slate-500 dark:text-slate-400">Saved</p>
                            <p class="font-bold text-sm ${savingsClass}">${savingsPercent}%</p>
                        </div>
                        
                        <button class="download-btn flex items-center gap-1.5 rounded-lg h-9 px-4 bg-primary hover:bg-primary-dark text-white text-sm font-bold transition-colors shadow-sm" data-id="${result.id}">
                            <span class="material-symbols-outlined text-lg">download</span>
                            <span>Download</span>
                        </button>
                    </div>
                `;
            } else {
                // Resize results
                const sizeChange = result.sizeChange >= 0 ? '+' : '';
                const sizeChangeClass = result.sizeChange < 0 ? 'text-success' : 
                                      result.sizeChange > 0 ? 'text-warning' : 'text-slate-600 dark:text-slate-400';
                
                resultElement.innerHTML = `
                    <div class="flex items-center gap-4 flex-1 min-w-0">
                        <div class="size-14 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-700 flex items-center justify-center">
                            <img src="${result.resultUrl}" alt="Resized" class="size-full object-cover">
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-slate-900 dark:text-white font-medium text-sm truncate">${result.name}</p>
                            <div class="flex flex-col gap-1 mt-1">
                                <div class="flex items-center gap-2">
                                    <span class="text-xs text-slate-500 dark:text-slate-400">${result.originalWidth}×${result.originalHeight} →</span>
                                    <span class="text-xs text-primary font-medium">${result.width}×${result.height}px</span>
                                </div>
                                <span class="text-xs text-slate-500 dark:text-slate-400">${result.format.split('/')[1].toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <div class="text-center">
                            <p class="text-xs text-slate-500 dark:text-slate-400">Original</p>
                            <p class="text-slate-900 dark:text-white font-medium text-sm">${formatFileSize(result.originalSize)}</p>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-xs text-slate-500 dark:text-slate-400">Resized</p>
                            <p class="text-slate-900 dark:text-white font-medium text-sm">${formatFileSize(result.processedSize)}</p>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-xs text-slate-500 dark:text-slate-400">Change</p>
                            <p class="font-bold text-sm ${sizeChangeClass}">${sizeChange}${result.sizeChangePercent}%</p>
                        </div>
                        
                        <button class="download-btn flex items-center gap-1.5 rounded-lg h-9 px-4 bg-primary hover:bg-primary-dark text-white text-sm font-bold transition-colors shadow-sm" data-id="${result.id}">
                            <span class="material-symbols-outlined text-lg">download</span>
                            <span>Download</span>
                        </button>
                    </div>
                `;
            }
            
            resultsContainer.appendChild(resultElement);
            
            // Add download event listener
            resultElement.querySelector('.download-btn').addEventListener('click', () => {
                downloadProcessedImage(result);
            });
        }

        // Download a single processed image
        function downloadProcessedImage(result) {
            const link = document.createElement('a');
            link.href = result.resultUrl;
            
            // Create filename based on mode
            const prefix = result.mode === 'compress' ? 'compressed_' : 'resized_';
            link.download = prefix + result.name;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Revoke object URL after delay
            setTimeout(() => {
                URL.revokeObjectURL(result.resultUrl);
            }, 1000);
        }

        // Download processed image by ID
        function downloadProcessedImageById(id) {
            const image = uploadedImages.find(img => img.id === id);
            if (!image || image.status === 'pending') {
                showToast('error', 'Image not processed yet');
                return;
            }
            
            const link = document.createElement('a');
            link.href = image.resultUrl;
            
            // Create filename based on mode
            const prefix = image.status === 'compressed' ? 'compressed_' : 'resized_';
            link.download = prefix + image.name;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('success', `Downloading "${image.name}"`);
        }

        // Download all processed images
        function downloadAllProcessed() {
            if (processedResults.length === 0) {
                // Check if any images have been processed
                const processedImages = uploadedImages.filter(img => img.status !== 'pending');
                if (processedImages.length === 0) {
                    showToast('error', 'No images have been processed yet');
                    return;
                }
                
                // Download all processed images
                alert(`Downloading ${processedImages.length} processed file(s) individually...`);
                
                processedImages.forEach((image, index) => {
                    setTimeout(() => {
                        const link = document.createElement('a');
                        link.href = image.resultUrl;
                        const prefix = image.status === 'compressed' ? 'compressed_' : 'resized_';
                        link.download = prefix + image.name;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }, index * 300);
                });
                
                return;
            }
            
            if (processedResults.length === 1) {
                // Single file, just download it
                downloadProcessedImage(processedResults[0]);
                return;
            }
            
            // For multiple files, download them individually
            alert(`Downloading ${processedResults.length} file(s) individually...`);
            
            processedResults.forEach((result, index) => {
                setTimeout(() => {
                    downloadProcessedImage(result);
                }, index * 300);
            });
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Toast notification
        function showToast(type, message) {
            // Remove existing toasts
            document.querySelectorAll('.toast-notification').forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast-notification fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 transform transition-transform duration-300 translate-x-full`;
            
            let bgColor = 'bg-green-500';
            let icon = 'check_circle';
            
            if (type === 'error') {
                bgColor = 'bg-red-500';
                icon = 'error';
            } else if (type === 'warning') {
                bgColor = 'bg-yellow-500';
                icon = 'warning';
            }
            
            toast.innerHTML = `
                <span class="material-symbols-outlined text-white">${icon}</span>
                <span class="text-white font-medium">${message}</span>
            `;
            
            toast.classList.add(bgColor);
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 10);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
            
            // Click to dismiss
            toast.addEventListener('click', () => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            });
        }

        // Initialize the application
        init();
    </script>
</body>
</html>